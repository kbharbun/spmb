<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - KB Harapan Bunda</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background-color: #f4f6f9; font-family: 'Segoe UI', sans-serif; }
        .login-container { max-width: 400px; margin: 100px auto; padding: 30px; background: white; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .dashboard-container { display: none; padding: 20px; }
        .card-header { background: #118AB2; color: white; font-weight: bold; }
        .badge-status { font-size: 0.9em; padding: 5px 10px; }
    </style>
</head>
<body>

    <div id="login-view" class="container">
        <div class="login-container text-center">
            <h4 class="mb-4">üîê Admin Login</h4>
            <div class="mb-3">
                <input type="password" id="adminPass" class="form-control" placeholder="Masukkan Password Admin">
            </div>
            <button onclick="loginAdmin()" class="btn btn-primary w-100">Masuk Dashboard</button>
        </div>
    </div>

    <div id="dashboard-view" class="dashboard-container container-fluid">
        <nav class="navbar navbar-light bg-white shadow-sm mb-4 rounded px-3">
            <span class="navbar-brand mb-0 h1"><i class="fas fa-user-graduate"></i> Data Pendaftaran</span>
            <button onclick="logout()" class="btn btn-outline-danger btn-sm">Keluar</button>
        </nav>

        <div class="card shadow">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Daftar Calon Siswa</span>
                <button onclick="loadData()" class="btn btn-light btn-sm"><i class="fas fa-sync"></i> Refresh Data</button>
            </div>
            <div class="card-body table-responsive">
                <table id="siswaTable" class="table table-hover table-bordered" style="width:100%">
                    <thead class="table-light">
                        <tr>
                            <th>No</th>
                            <th>Tanggal Daftar</th>
                            <th>Nama Anak</th>
                            <th>Jenis Kelamin</th>
                            <th>Orang Tua / HP</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // --- KONFIGURASI ---
        // Masukkan URL Google Script yang SAMA dengan yang di index.html
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzPUY0lyHteUrgq0TKhSpUE_OTFbbFFr2P1ihHJ_VI_cnASNvBNb4E2M5GYSJHmwS4X/exec'; 
        
        // Password Admin (Harus sama dengan di Code.gs)
        const PASSWORD_RAHASIA = "bunda123"; 

        // --- LOGIC ---
        
        // Cek apakah sudah login sebelumnya
        if(sessionStorage.getItem('isLoggedIn') === 'true') {
            showDashboard();
        }

        function loginAdmin() {
            const pass = document.getElementById('adminPass').value;
            if(pass === PASSWORD_RAHASIA) {
                sessionStorage.setItem('isLoggedIn', 'true');
                showDashboard();
            } else {
                Swal.fire('Gagal', 'Password salah, Bunda!', 'error');
            }
        }

        function logout() {
            sessionStorage.removeItem('isLoggedIn');
            location.reload();
        }

        function showDashboard() {
            document.getElementById('login-view').style.display = 'none';
            document.getElementById('dashboard-view').style.display = 'block';
            loadData();
        }

        function loadData() {
            // Tampilkan loading
            Swal.fire({title: 'Memuat Data...', didOpen: () => { Swal.showLoading() }});

            const formData = new FormData();
            formData.append('action', 'ambil_data_admin');
            formData.append('password', PASSWORD_RAHASIA);

            fetch(scriptURL, { method: 'POST', body: formData })
            .then(res => res.json())
            .then(response => {
                if(response.result === 'success') {
                    const tbody = document.getElementById('tableBody');
                    tbody.innerHTML = '';
                    
                    response.data.forEach(row => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${row.no}</td>
                                <td>${row.tanggal}</td>
                                <td class="fw-bold">${row.nama}</td>
                                <td>${row.jk}</td>
                                <td>${row.ortu}</td>
                                <td><span class="badge bg-success">${row.status}</span></td>
                            </tr>
                        `;
                    });

                    // Inisialisasi DataTable (Biar bisa search & sort)
                    if ($.fn.DataTable.isDataTable('#siswaTable')) {
                        $('#siswaTable').DataTable().destroy();
                    }
                    $('#siswaTable').DataTable({
                        language: { url: "//cdn.datatables.net/plug-ins/1.13.4/i18n/id.json" }
                    });

                    Swal.close();
                } else {
                    Swal.fire('Error', response.message, 'error');
                }
            })
            .catch(err => {
                Swal.fire('Error', 'Gagal mengambil data', 'error');
                console.error(err);
            });
        }
    </script>
</body>
</html>
