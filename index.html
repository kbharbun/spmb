<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPMB Online - KB Harapan Bunda</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- VARIABEL & RESET --- */
        :root {
            --primary: #FFD166;    /* Kuning Cerah */
            --secondary: #118AB2;  /* Biru Laut */
            --accent: #EF476F;     /* Pink Kemerahan */
            --dark: #073B4C;       /* Biru Gelap */
            --paper: #FFFFFF;
            --bg: #F0F2F5;
            --success: #06D6A0;
            --shadow: 0 10px 25px rgba(0,0,0,0.08);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 20px 10px;
        }

        /* --- KONTAINER A4 --- */
        .a4-wrapper {
            background: var(--paper);
            width: 100%;
            max-width: 800px;
            min-height: 90vh;
            border-radius: 8px; /* Sedikit lengkung di layar HP */
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, var(--primary), #FFC107);
            padding: 40px 30px;
            text-align: center;
            border-bottom: 6px solid var(--accent);
            position: relative;
            overflow: hidden;
        }
        
        .circle-decor { position: absolute; background: rgba(255,255,255,0.25); border-radius: 50%; z-index: 0; }
        .c1 { width: 120px; height: 120px; top: -30px; left: -30px; }
        .c2 { width: 80px; height: 80px; bottom: 10px; right: 20px; }

        header * { position: relative; z-index: 1; }
        header h2 { font-family: 'Fredoka', sans-serif; color: var(--secondary); font-size: 1.4rem; letter-spacing: 1px; margin-bottom: 5px; }
        header h1 { font-family: 'Fredoka', sans-serif; color: var(--dark); font-size: 2.5rem; text-transform: uppercase; margin-bottom: 10px; line-height: 1.2; }
        header h3 { font-family: 'Fredoka', sans-serif; color: var(--secondary); font-size: 1.2rem; margin-top: 5px; }
        .badge { background: var(--accent); color: white; padding: 5px 20px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; display: inline-block; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }

        /* --- KONTEN UTAMA & ANIMASI --- */
        .content-section {
            padding: 40px 30px;
            flex: 1;
            /* Transisi halus saat pindah view */
            opacity: 1;
            transition: opacity 0.4s ease-in-out, transform 0.4s ease;
        }
        
        /* Kelas untuk menyembunyikan section dengan animasi */
        .hidden {
            display: none;
            opacity: 0;
            transform: translateY(10px);
        }

        .welcome-text { text-align: center; margin-bottom: 40px; }
        .welcome-text h3 { color: var(--secondary); font-family: 'Fredoka', sans-serif; font-size: 1.8rem; margin-bottom: 10px; }
        .welcome-text p { color: #555; line-height: 1.6; }

        /* --- INFO GRID --- */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .info-card { 
            background: #F8FDFF; border: 2px solid #E0F7FA; 
            padding: 20px; border-radius: 15px; 
            border-left: 5px solid var(--secondary);
            transition: 0.3s;
        }
        .info-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-color: var(--secondary); }
        .info-card h4 { color: var(--secondary); font-size: 0.9rem; margin-bottom: 8px; text-transform: uppercase; display: flex; align-items: center; gap: 8px; }
        .info-card p { font-weight: 600; font-size: 1rem; color: #333; }
        .info-card small { font-weight: normal; color: #666; font-size: 0.85rem; }

        /* --- GALERI --- */
        .gallery { text-align: center; margin-bottom: 40px; }
        .gallery h3 { font-family: 'Fredoka', sans-serif; color: var(--accent); font-size: 1.6rem; margin-bottom: 20px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        
        .photo-frame { 
            aspect-ratio: 4/3; 
            background: #eee; 
            border-radius: 12px; 
            overflow: hidden; 
            border: 4px solid white; 
            box-shadow: 0 3px 8px rgba(0,0,0,0.1); 
            position: relative;
        }
        .photo-frame img { 
            width: 100%; height: 100%; object-fit: cover; 
            transition: 0.4s; 
        }
        .photo-frame:hover img { transform: scale(1.1); }

        /* --- TOMBOL --- */
        .cta-container { text-align: center; margin-top: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px; }
        
        .btn {
            padding: 12px 30px; border-radius: 50px;
            font-size: 1rem; font-weight: 600; border: none;
            cursor: pointer; text-decoration: none;
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            transition: all 0.3s;
        }

        .btn-daftar {
            background: var(--secondary); color: white;
            box-shadow: 0 4px 15px rgba(17, 138, 178, 0.4);
        }
        .btn-daftar:hover { background: #0c6ba1; transform: translateY(-2px); }

        .btn-wa {
            color: #25D366; background: white;
            border: 2px solid #25D366;
        }
        .btn-wa:hover { background: #25D366; color: white; }

        .btn-back { 
            background: none; border: none; color: #777; cursor: pointer; 
            display: flex; align-items: center; gap: 8px; margin-bottom: 20px; font-weight: 500; 
            padding: 0;
        }
        .btn-back:hover { color: var(--secondary); transform: translateX(-5px); }

        /* --- FORMULIR --- */
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: var(--dark); font-size: 0.95rem; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 12px 15px; border: 2px solid #eee; border-radius: 8px;
            font-family: inherit; transition: 0.3s; background: #fafafa;
        }
        .form-group input:focus, .form-group textarea:focus { border-color: var(--secondary); background: white; box-shadow: 0 0 0 3px rgba(17,138,178,0.1); }
        
        .divider { border-top: 2px dashed #ddd; margin: 30px 0; position: relative; }
        .divider span { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 10px; color: #aaa; font-size: 0.8rem; font-weight: bold; letter-spacing: 1px; }

        /* --- LOADING OVERLAY --- */
        .loading { 
            display: none; position: fixed; top:0; left:0; width:100%; height:100%; 
            background: rgba(255,255,255,0.95); z-index: 999; 
            justify-content: center; align-items: center; flex-direction: column; 
        }
        .spinner { 
            width: 50px; height: 50px; border: 5px solid #f3f3f3; 
            border-top: 5px solid var(--secondary); border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* --- TOAST NOTIFICATION (PENGGANTI ALERT) --- */
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background: white; padding: 15px 20px; border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15); border-left: 5px solid #333;
            display: flex; align-items: center; gap: 12px;
            animation: slideIn 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            max-width: 350px;
        }
        .toast.success { border-color: var(--success); }
        .toast.success i { color: var(--success); }
        .toast.error { border-color: var(--accent); }
        .toast.error i { color: var(--accent); }
        .toast-content h4 { font-size: 0.95rem; margin-bottom: 2px; }
        .toast-content p { font-size: 0.85rem; color: #666; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

        /* Responsive */
        @media (max-width: 600px) {
            body { padding: 0; background: white; }
            .a4-wrapper { box-shadow: none; max-width: 100%; border-radius: 0; min-height: 100vh; }
            header h1 { font-size: 2rem; }
            .gallery-grid { grid-template-columns: 1fr; } 
            #toast-container { left: 20px; right: 20px; }
            .toast { max-width: 100%; }
        }
    </style>
</head>
<body>

    <div class="a4-wrapper">
        <!-- HEADER -->
        <header>
            <div class="circle-decor c1"></div>
            <div class="circle-decor c2"></div>
            
            <h2 id="sub-judul">Sistem Penerimaan Murid Baru</h2>
            <h1 id="judul-utama">KB HARAPAN BUNDA</h1>
            <div class="badge" id="tahun-ajaran">Tahun Ajaran 2026/2027</div>
        </header>

        <!-- VIEW 1: BROCHURE -->
        <div id="view-brochure" class="content-section">
            <div class="welcome-text">
                <h3 id="hero-title">Selamat Datang Ayah & Bunda!</h3>
                <p id="slogan">Mari bergabung bersama keluarga besar kami. Membentuk generasi cerdas, ceria, dan berakhlak mulia dalam lingkungan yang aman dan menyenangkan.</p>
            </div>

            <div class="info-grid">
                <div class="info-card">
                    <h4><i class="fas fa-calendar-check"></i> Pendaftaran</h4>
                    <p id="periode-daftar">Januari 2026</p>
                    <small>Gelombang 1</small>
                </div>
                <div class="info-card">
                    <h4><i class="fas fa-map-marker-alt"></i> Lokasi</h4>
                    <p id="alamat-sekolah">Wisma Harapan Blok D01/13, Gembor - Tangerang</p>
                </div>
                <div class="info-card">
                    <h4><i class="fas fa-phone"></i> Kontak</h4>
                    <p id="kontak-person">Ibu Rosmalawati</p>
                    <small id="no-kontak">0813-9880-2930</small>
                </div>
            </div>

            <div class="gallery">
                <h3 id="judul-galeri">Galeri Kegiatan</h3>
                <div class="gallery-grid">
                    <!-- Placeholder images using Picsum for fallback demonstration -->
                    <div class="photo-frame">
                        <img id="img-1" src="img/foto1.jpg" alt="Kegiatan 1">
                    </div>
                    <div class="photo-frame">
                        <img id="img-2" src="img/foto2.jpg" alt="Kegiatan 2">
                    </div>
                    <div class="photo-frame">
                        <img id="img-3" src="img/foto3.jpg" alt="Kegiatan 3">
                    </div>
                </div>
            </div>

            <div class="cta-container">
                <button onclick="bukaFormulir()" class="btn btn-daftar">
                    <i class="fas fa-pen-fancy"></i> Isi Formulir Pendaftaran
                </button>
                <a href="https://wa.me/6281398802930" target="_blank" class="btn btn-wa" id="link-wa">
                    <i class="fab fa-whatsapp"></i> Tanya via WhatsApp
                </a>
            </div>
            
            <div style="text-align: center; margin-top: 40px; color: #ccc; font-size: 0.8rem;">
                &copy; 2026 KB Harapan Bunda.
            </div>
        </div>

        <!-- VIEW 2: FORMULIR -->
        <div id="view-form" class="content-section hidden">
            <button onclick="tutupFormulir()" class="btn-back"><i class="fas fa-arrow-left"></i> Kembali ke Brosur</button>
            
            <div class="form-header" style="text-align: center; margin-bottom: 30px;">
                <h3 style="color: var(--secondary); font-family: 'Fredoka', sans-serif;">Formulir Pendaftaran</h3>
                <p style="color: #666; font-size: 0.9rem;">Mohon isi data calon siswa dengan lengkap dan benar.</p>
            </div>

            <form id="formPendaftaran">
                <input type="hidden" name="action" value="simpan_pendaftaran">

                <div class="form-group">
                    <label>Nama Lengkap Anak</label>
                    <input type="text" name="nama" required placeholder="Sesuai Akta Kelahiran">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Tanggal Lahir</label>
                        <input type="date" name="tgl_lahir" required>
                    </div>
                    <div class="form-group">
                        <label>Jenis Kelamin</label>
                        <select name="jk" required>
                            <option value="">- Pilih -</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Agama</label>
                    <select name="agama" required>
                        <option value="Islam">Islam</option>
                        <option value="Kristen">Kristen</option>
                        <option value="Katolik">Katolik</option>
                        <option value="Hindu">Hindu</option>
                        <option value="Buddha">Buddha</option>
                    </select>
                </div>

                <div class="divider"><span>DATA ORANG TUA</span></div>

                <div class="form-group">
                    <label>Nama Ayah</label>
                    <input type="text" name="nama_ayah" required>
                </div>
                <div class="form-group">
                    <label>Pekerjaan Ayah</label>
                    <input type="text" name="pek_ayah" required>
                </div>

                <div class="form-group">
                    <label>Nama Ibu</label>
                    <input type="text" name="nama_ibu" required>
                </div>
                <div class="form-group">
                    <label>Pekerjaan Ibu</label>
                    <input type="text" name="pek_ibu" required>
                </div>

                <div class="form-group">
                    <label>No. HP Ibu (WhatsApp)</label>
                    <input type="tel" name="hp_ibu" required placeholder="Contoh: 08123456789">
                    <small style="color: #999; font-size: 0.8rem;">*Wajib nomor yang aktif WA</small>
                </div>

                <div class="form-group">
                    <label>Alamat Domisili</label>
                    <textarea name="alamat" rows="3" required placeholder="Jalan, RT/RW, Kelurahan..."></textarea>
                </div>

                <div class="divider"><span>DATA WALI (Jika Ada)</span></div>
                
                <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px dashed #ccc;">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>Nama Wali</label>
                        <input type="text" name="nama_wali">
                    </div>
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label>Pekerjaan Wali</label>
                        <input type="text" name="pek_wali">
                    </div>
                    <div class="form-group">
                        <label>No. HP Wali</label>
                        <input type="tel" name="hp_wali" placeholder="Opsional">
                    </div>
                    <div class="form-group">
                        <label>Alamat Wali</label>
                        <textarea name="alamat_wali" rows="2" placeholder="Sama dengan orang tua atau isi alamat lain..."></textarea>
                    </div>
                </div>

                <button type="submit" class="btn btn-daftar" style="width: 100%; justify-content: center; margin-top: 20px;">
                    Kirim Pendaftaran <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- LOADING OVERLAY -->
    <div class="loading" id="loadingOverlay">
        <div class="spinner"></div>
        <h3 style="margin-top: 20px; color: var(--secondary);">Sedang Memproses...</h3>
        <p style="font-size: 0.9rem; color: #777;">Mohon jangan tutup halaman ini.</p>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toast-container"></div>

    <script>
        // --- KONFIGURASI ---
        // Ganti URL ini dengan URL Web App Google Apps Script Anda
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxObNo1BFGjWUnRnni96YUhjOGipY1lViTfVPfyRZDbhGbuPY6nDNrX2Nu89HxqmBzRhA/exec';

        // --- 1. FUNGSI NAVIGASI & UI ---
        function bukaFormulir() {
            document.getElementById('view-brochure').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('view-brochure').style.display = 'none';
                const formView = document.getElementById('view-form');
                formView.style.display = 'block';
                // Sedikit delay agar animasi CSS jalan
                setTimeout(() => formView.classList.remove('hidden'), 50);
            }, 300); // Tunggu animasi fade out selesai
            window.scrollTo(0,0);
        }

        function tutupFormulir() {
            document.getElementById('view-form').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('view-form').style.display = 'none';
                const brochureView = document.getElementById('view-brochure');
                brochureView.style.display = 'block';
                setTimeout(() => brochureView.classList.remove('hidden'), 50);
            }, 300);
            window.scrollTo(0,0);
        }

        // --- 2. SISTEM NOTIFIKASI (TOAST) ---
        function showToast(type, title, message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            let icon = type === 'success' ? '<i class="fas fa-check-circle fa-lg"></i>' : '<i class="fas fa-exclamation-circle fa-lg"></i>';
            
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                ${icon}
                <div class="toast-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            `;
            
            container.appendChild(toast);

            // Hapus toast setelah 4 detik
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.5s forwards';
                toast.addEventListener('animationend', () => {
                    toast.remove();
                });
            }, 4000);
        }

        // --- 3. IMAGE FALLBACK HELPER ---
        function handleImageError(img) {
            // Jika gambar lokal gagal muat, ganti dengan Picsum Random
            if (!img.getAttribute('data-fallback')) {
                img.src = `https://picsum.photos/seed/${img.id}/400/300`;
                img.setAttribute('data-fallback', 'true');
            }
        }

        // Event listener untuk error gambar
        document.querySelectorAll('img').forEach(img => {
            img.onerror = function() { handleImageError(this); };
        });

        // --- 4. AMBIL DATA DARI ADMIN PANEL ---
        document.addEventListener('DOMContentLoaded', async () => {
            // Tampilkan loading singkat saat fetch data (opsional, agar UX lebih mulus)
            // document.getElementById('loadingOverlay').style.display = 'flex'; 
            
            try {
                const response = await fetch(scriptURL + '?action=get_admin_data');
                const data = await response.json();

                if (data.result === 'success' && data.konten) {
                    const c = data.konten;
                    
                    // Update Teks Hanya Jika Ada Isinya
                    if(c.judulUtama) document.getElementById('judul-utama').innerText = c.judulUtama;
                    if(c.subJudul) document.getElementById('sub-judul').innerText = c.subJudul;
                    if(c.slogan) document.getElementById('slogan').innerText = c.slogan;
                    if(c.tahunAjaran) document.getElementById('tahun-ajaran').innerText = c.tahunAjaran;
                    if(c.heroText) document.getElementById('hero-title').innerText = c.heroText;
                    if(c.alamatSekolah) document.getElementById('alamat-sekolah').innerText = c.alamatSekolah;
                    
                    if(c.nomorKontak) {
                        document.getElementById('no-kontak').innerText = c.nomorKontak;
                        // Update link WA otomatis
                        let cleanNum = c.nomorKontak.replace(/\D/g, ''); 
                        if(cleanNum.startsWith('0')) cleanNum = '62' + cleanNum.slice(1);
                        const waLink = document.getElementById('link-wa');
                        waLink.href = `https://wa.me/${cleanNum}`;
                    }
                    
                    // Update Gambar jika URL ada di Admin
                    if(c.gambar1) document.getElementById('img-1').src = c.gambar1;
                    if(c.gambar2) document.getElementById('img-2').src = c.gambar2;
                    if(c.gambar3) document.getElementById('img-3').src = c.gambar3;
                }
            } catch (e) {
                console.log("Mode Offline / Gagal fetch admin data:", e);
            } finally {
                // document.getElementById('loadingOverlay').style.display = 'none';
            }
        });

        // --- 5. KIRIM FORMULIR ---
        const form = document.getElementById('formPendaftaran');
        const loading = document.getElementById('loadingOverlay');

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            // Validasi sederhana (misal: pastikan WA diisi minimal 10 digit)
            const hpIbu = form.querySelector('[name="hp_ibu"]').value;
            if(hpIbu.length < 10) {
                showToast('error', 'Nomor HP Tidak Valid', 'Masukkan nomor WA yang benar (min 10 digit).');
                return;
            }

            if(!confirm("Apakah data yang Anda isi sudah SUDAH BENAR?")) return;

            loading.style.display = 'flex';
            
            fetch(scriptURL, { 
                method: 'POST', 
                body: new FormData(form), 
                mode: 'no-cors' 
            })
            .then(() => {
                loading.style.display = 'none';
                // Karena no-cors, kita asumsikan sukses jika tidak ada network error
                showToast('success', 'Alhamdulillah!', 'Data berhasil terkirim. Silakan konfirmasi via WA.');
                form.reset();
                tutupFormulir();
            })
            .catch(error => {
                loading.style.display = 'none';
                console.error('Error!', error.message);
                showToast('error', 'Gagal Terkirim', 'Ada gangguan jaringan. Silakan coba lagi atau hubungi Admin WA.');
            });
        });
    </script>
</body>
</html>
